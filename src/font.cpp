// VT Nibbler
// Copyright (c) 2024 James Holderness
// Distributed under the MIT License

#include "font.h"

#include "capabilities.h"

#include <array>
#include <iostream>
#include <string>
#include <string_view>

constexpr auto font_8x10 = R"(0;1;1;4;0;0{ @
~~??????/NN??????;
??__~~zz/MDDDBNNN;
zz~~__??/NNNBDDDM;
@AEMNN^Z/????????;
Z^NNMEA@/????????;
??????__/GCEFNNNL;
^N??????/????????;
__??????/LNNNFECG;
FIYY{~~~/????NNLL;
~~~{YYIF/LLNN????;
????????/???????M;
??????_o/??????NN;
????_{~~/????NNLL;
o_??????/NN??????;
wggwwgn~/????????;
w{CCCC{w/?@@@@@@?;
??C{{???/?@@@@@@?;
ccSSSS[G/@@@@@@@@;
?CCSSS{k/@@@@@@@?;
ooggc{{_/?????@@?;
[SSSSSs_/@@@@@@@?;
w{SSSSs_/?@@@@@@?;
CCCcsSKK/???@@???;
g{SSSS{g/?@@@@@@?;
G[SSSS{w/?@@@@@@?;
wggwwggw/??????NN;
wggwwggw/NN??????;
??????Ow/????????;
wggwwggw/????????;
wO??????/????????;
????????/M???????;
~~{_????/LLNN????;
owgccgwo/@@????@@;
????????/????????;
w{CCCCCC/?@@@@@@@;
~ngwwggw/NN??????;
{{SSSSCC/@@@@@@@@;
{{SSSSCC/@@??????;
ggwwwgn~/??????NN;
{{OOOO{{/@@????@@;
?CC{{CC?/?@@@@@@?;
??__{{{{/MDDDBNNN;
{{{{__??/NNNBDDDM;
{{??????/@@@@@@@@;
{{WooW{{/@@????@@;
FIYY{~~~/????@@@@;
w{CCCC{w/?@@@@@@?;
{{SSSS[G/@@??????;
~~~{YYIF/@@@@????;
{{SSss[G/@@????@@;
G[SSSSsc/@@@@@@@?;
CCC{{CCC/???@@???;
~^F?????/B???????;
[{_??_{[/???@@???;
{{_OO_{{/@@????@@;
???~HHH~/???NHHHN;
K[O__O[K/???@@???;
HHH~HHH~/HHHNHHHN;
????^~zz/?????BNN;
~ngwwggw/????????;
zz~^????/NNB?????;
???????F/????????;
F???????/????????;
??????N^/????????;
}}}}|zzx/BBBBDEEC;
|}mEEk{w/DBBBB@@?;
w{kEEm}|/?@@BBBBD;
xzz|}}}}/CEEDBBBB;
{IJJf~~~/?@BFFFNL;
~~~fJJI{/LNFFFB@?;
oGKM]}~z/BDLLMNNN;
z~}]MKGo/NNNMLLDB;
{kkCCkk{/@@@@@@@@;
????~~zz/????NNLL;
zz~~????/LLNN????;
????{{{{/????NNLL;
{kkCCkk{/LLNN@@@@;
{kkCCkk{/@@@@NNLL;
{{{{????/LLNN????;
{kkCFnjz/@@@@@@@@;
zz~~????/@@@@????;
????~~zz/????@@@@;
zjnFCkk{/@@@@@@@@;
{{{{{www/@@@@@???;
wwwOOOOO/????????;
OOOOOwww/????????;
www{{{{{/???@@@@@;
??????_{/?????MNN;
{_??????/NNM?????;
?????F^~/???????B;
????Oggs/???????@;
??????~~/??????NN;
[ggO????/@???????;
?___????/?@BB????
)";

constexpr auto font_15x12 = R"(0;1;1;15;0;2;12;0{ @
l~~~???????????/l~~~???????????;
???????~~~rr```/owSUUVFN~~~~~~~;
``rr~~~????????/~~~~~~NFVUUSwo?;
?@EMM]^^^~~zzpp/???????????????;
pzz~~^^^]MME@??/???????????????;
???????????????/?_W[[]}}}~~vvbb;
l~~~???????????/@@?????????????;
???????????????/bvv~~}}}][[W_??;
BFIYYyw{~~~~~~~/???????~~~rr```;
~~~~~~{wyYYIFB?/``rr~~~????????;
???????????????/??????????_w}~~;
??????????__ooo/??????????~~~ll;
????????w}~~~~~/???????~~~rr```;
oo__???????????/l~~~???????????;
ooOOOooooO^^~ll/@@@@@@@@@@@@@@@;
?oowGGGGGGwoo??/?@@BAAAAAAB@@??;
????GGwww??????/???AAABBBAAA???;
?GGGgggggwwwO??/?BBBBBAAAAAAA??;
?GGGgggwwwgg???/?AAAAAAAAABB@??;
??__oOWGGwww???/?@@@@@@@@BBB@??;
?wwwgggggggg???/?AAAAAAAAABB@??;
?owwgggggggg???/?@BBAAAAAABB@??;
?GGGGGGggwWWG??/?????BBB???????;
?OwwggggggwO???/?@BBAAAAAABB@??;
?Owwggggggwwo??/??AAAAAAAABB@??;
ooOOOooooOOOooo/@@@@@@@@@@~~~ll;
ooOOOooooOOOooo/l~~~@@@@@@@@@@@;
??????????__ooo/????????????@@@;
ooOOOooooOOOooo/@@@@@@@@@@@@@@@;
oo__???????????/@@?????????????;
???????????????/~}w_???????????;
~~~~}w?????????/``rr~~~????????;
?__oOWGGGWOo__?/?BBB@@@@@@@BBB?;
???????????????/???????????????;
?oowGGGGGGGGGG?/?@@BAAAAAAAAAA?;
l~^^OooooOOOooo/l~~~@@@@@@@@@@@;
??wwwggggggGGG?/??BBBAAAAAAAAA?;
??wwwggggggGGG?/??BBB??????????;
oOOOoooooO^^~ll/@@@@@@@@@@~~~ll;
?www_______www?/?BBB???????BBB?;
???GGGwwwGGG???/???AAABBBAAA???;
???????wwwwwwww/owSUUVFN~~~~~~~;
wwwwwww????????/~~~~~~NFVUUSwo?;
??www??????????/??BBBAAAAAAAAA?;
?wwwWoo_ooWwww?/?BBB???@???BBB?;
BFIYYyw{~~~~~~~/???????FFFFFFFF;
?owwGGGGGGGwwo?/?@BBAAAAAAABB@?;
?wwwgggggggwwO?/?BBB???????????;
~~~~~~{wyYYIFB?/FFFFFFF????????;
?wwwGGGGGGgwwo?/?BBB@@@@@@BAAA?;
?Owwggggggggg??/?AAAAAAAAAABB@?;
??GGGGwwwGGGG??/??????BBB??????;
~~~~^F?????????/~^F@???????????;
?Www__???__wwW?/????@@BBB@@????;
?www?__o__?www?/?@BB@@@?@@@BB@?;
?????}}}QQQQQ}}/?????^^^QQQQQ^^;
?WWw_______wWW?/??????BBB??????;
QQQQQ}}}QQQQQ}}/QQQQQ^^^QQQQQ^^;
???????~~~rr```/????????F^~~~~~;
l~^^OooooOOOooo/@@@@@@@@@@@@@@@;
``rr~~~????????/~~~~^F?????????;
??????????@F^~~/???????????????;
~^F@???????????/???????????????;
??????????~~~ll/????????????@@@;
{{}}}}}xxvvvppp/NN^^^^^ffzzzbbb;
pxx}]]MMK[[{wwo/bff^^^]]MNNNFFB;
oww{[[KMM]]}xxp/BFFNNNM]]^^^ffb;
pppvvvxx}}}}}{{/bbbzzzff^^^^^NN;
owSUUVFN~~~~~~~/?@EMM]^^^~~zzpp;
~~~~~~NFVUUSwo?/pzz~~^^^]MME@??;
?_W[[]}}}~~vvbb/BFIYYyw{~~~~~~~;
bvv~~}}}][[W_??/~~~~~~{wyYYIFB?;
wwwWWGGGGGWWwww/FFFEECCCCCEEFFF;
???????~~~rr```/???????~~~rr```;
``rr~~~????????/``rr~~~????????;
???????wwwwwwww/???????~~~rr```;
wwwWWGGGGGWWwww/``rq}{{CCCEEFFF;
wwwWWGGGGGWWwww/FFFEECC{{{qq```;
wwwwwww????????/``rr~~~????????;
wwwWWGGNNNRR```/FFFEECCCCCEEFFF;
``rr~~~????????/FFFFFFF????????;
???????~~~rr```/???????FFFFFFFF;
``rR^NNGGGWWwww/FFFEECCCCCEEFFF;
woooooooooooooo/FBBBBBBBBBBBBBB;
o______________/B@@@@@@@@@@@@@@;
______________o/@@@@@@@@@@@@@@B;
oooooooooooooow/BBBBBBBBBBBBBBF;
??????????_w}~~/????????w}~~~~~;
~}w_???????????/~~~~}w?????????;
????????F^~~~~~/??????????@F^~~;
???????oOOWggks/???????@@@BBBDD;
??????????~~~ll/??????????~~~ll;
sswwWOOo???????/DEAAB@@@???????;
???????????????/???BFFF????????
)";

constexpr auto font_10x20 = R"(0;1;1;10;0;2;20;0{ @
r~~???????/x~~???????/[~~???????/ABB???????;
?????~~NFB/???_o~~~}{/owvvvN~~~~/BB????BBBB;
BFN~~?????/{}~~~o_???/~~~~Nvvvwo/BBBB????BB;
@B[{{}~~NF/???@BFFNNM/??????????/??????????;
FN~~}{{[B@/MNNFFB@???/??????????/??????????;
??????????/?????__ooo/??w}~~~~r`/AB???@BBBB;
r~~???????/x~^???????/@?????????/??????????;
??????????/ooo__?????/`r~~~~}w??/BBBB@???BA;
N^kkko~~~~/??BFN~~~~~/?????~~r`?/?????BBBBB;
~~~~okkk^N/~~~~~NFB??/?`r~~?????/BBBBB?????;
??????????/?????????o/????????{~/???????ABB;
??????????/???????w{}/???????~~[/???????BBA;
??????o~~~/?????o~~~~/?????~~r`?/?????BBBBB;
??????????/}{w???????/[~~???????/ABB???????;
???????~~r/}ee}}}efrx/@@@@@@@@@@/??????????;
??_____???/}~????@~}?/?@BAAAA@??/??????????;
????__????/???@~~????/??AABBAA??/??????????;
?_______??/@`owWW[NF?/BBBAAAAAA?/??????????;
?________?/???GKMJxo?/@BAAAAAB@?/??????????;
?????___??/owkeb`~~_?/??????BB??/??????????;
________??/FFCCCCC{w?/@BAAAAAB@?/??????????;
??______??/}~HGGGGwo?/@BAAAAAB@?/??????????;
_________?/@@?owKEB@?/???BB?????/??????????;
?______???/vNKGGWWvo?/@AAAAAAB@?/??????????;
?_______??/FNGGGGG~~?/?AAAAAB@??/??????????;
??????????/}ee}}}eeMM/@@@@@@@~~[/???????BBA;
??????????/]Ee}}}ee}}/[~~@@@@@@@/ABB???????;
??????????/???????W{}/?????????@/??????????;
??????????/}ee}}}ee}}/@@@@@@@@@@/??????????;
??????????/}{W???????/@?????????/??????????;
??????????/o?????????/~{????????/BBA???????;
~~~o??????/~~~~o?????/?`r~~?????/BBBBB?????;
???___????/{}RPOPR}{?/BB?????BB?/??????????;
??????????/??????????/??????????/??????????;
??______??/}~@????@@?/?@BAAAAB@?/??????????;
r~~???????/PBf}}}ee}}/[~~@@@@@@@/ABB???????;
?________?/?~~GGGG???/?BBAAAAAA?/??????????;
?________?/?~~GGGG???/?BB???????/??????????;
???????~~r/}ee}}}efBH/@@@@@@@~~[/???????BBA;
__?????__?/~~GGGGG~~?/BB?????BB?/??????????;
??______??/????~~????/??AABBAA??/??????????;
?????_____/???_o~~~~~/owvvvN~~~~/BB????BBBB;
_____?????/~~~~~o_???/~~~~Nvvvwo/BBBB????BB;
?__???????/?~~???????/?BBAAAAAA?/??????????;
__?????__?/~~FM[MF~~?/BB?????BB?/??????????;
N^kkko~~~~/??BFN~~~~~/?????FFFFF/??????????;
?_______??/~~?????~~?/@BAAAAAB@?/??????????;
________??/~~OOOOO^N?/BB????????/??????????;
~~~~okkk^N/~~~~~NFB??/FFFFF?????/??????????;
________??/~~OOoowNN?/BB???@BBA?/??????????;
?______???/FNGGGGHxo?/@BAAAAAB@?/??????????;
?________?/????~~????/????BB????/??????????;
~~~~??????/~~^???????/~N????????/B?????????;
__?????__?/N^wo_ow^N?/???@B@????/??????????;
__?????__?/~~ow[wo~~?/?B@???@B??/??????????;
????{CCCC{/????~AAAA~/????~````~/??????????;
?__????__?/?BFKwwKFB?/????BB????/??????????;
CCCC{CCCC{/AAAA~AAAA~/````~````~/??????????;
?????~~NFB/?????N~~}{/??????N~~~/???????BBB;
r~~???????/pbf}}}ee}}/@@@@@@@@@@/??????????;
BFN~~?????/{}~~N?????/~~~N??????/BBB???????;
???????@~~/?????????N/??????????/??????????;
~~@???????/N?????????/??????????/??????????;
???????~~r/???????^~x/?????????@/??????????;
ow{{{a^^BB/~~~~~~~~~~/N^~~~FzzBB/?????@BBBB;
Ba{{{wwo_?/~~~fBBf~~}/BF~~~^^NF@/B@????????;
?_oww{{{aB/}~~fBBf~~~/@FN^^~~~FB/????????@B;
BB^^a{{{wo/~~~~~~~~~~/BBzzF~~~^N/BBBB@?????;
?_[]^~~~~~/^~BBB_~~~~/??F^~~~~r`/?????@@BBB;
~~~~~^][_?/~~~~_BBB~^/`r~~~~^F??/BBB@@?????;
??_w{}}~NF/w{BBBF~~~}/BFzzz{~~~~/???@BBBBBB;
FN~}}{w_??/}~~~FBBB{w/~~~~{zzzFB/BBBBBB@???;
__________/~~fB@@Bf~~/FFFFEEFFFF/??????????;
?????~~NFB/?????~~~}{/?????~~r`?/?????BBBBB;
BFN~~?????/{}~~~?????/?`r~~?????/BBBBB?????;
?????_____/?????~~~~~/?????~~r`?/?????BBBBB;
__________/~~fB@@Bf~~/?`r~}EFFFF/BBBBB?????;
__________/~~fB@@Bf~~/FFFFE}~r`?/?????BBBBB;
_____?????/~~~~~?????/?`r~~?????/BBBBB?????;
_____~~NFB/~~fB@@Bf}{/FFFFEEFFFF/??????????;
BFN~~?????/{}~~~?????/FFFFF?????/??????????;
?????~~NFB/?????~~~}{/?????FFFFF/??????????;
BFN~~_____/{}fB@@Bf~~/FFFFEEFFFF/??????????;
??????????/~~~~~~}}}}/BBBBBB@@@@/??????????;
??????????/}{{{{{WWWW/@?????????/??????????;
??????????/WWWW{{{{{}/?????????@/??????????;
??????????/}}}}~~~~~~/@@@@BBBBBB/??????????;
????????o~/???????w~~/??????{~~~/??????BBBB;
~o????????/~~w???????/~~~{??????/BBBB??????;
??????~~~~/???????^~~/????????N~/?????????B;
?????????_/?????Wkuz|/???????@BD/??????????;
???????~~r/???????~~x/???????~~[/???????BBA;
_?????????/}^msW?????/EB@???????/??????????;
??????????/??___?????/??BNN?????/??????????
)";

constexpr auto font_12x30 = R"(0;1;1;12;0;2;30;0{ @
b~~~????????/F~~~????????/^~~~????????/{~~~????????/w~~~????????;
??????~~~NFF/??????~~w_??/???oww~~~~~~/?oNNNN~~~~~~/~~FFFF?~~~~~;
FFN~~~??????/??_w~~??????/~~~~~~wwo???/~~~~~~NNNNo?/~~~~~?FFFF~~;
@Fwwww}~~~~^/??@N~~~~~~wo/?????@BBFFFF/????????????/????????????;
^~~~~}wwwwF@/ow~~~~~~N@??/FFFFBB@?????/????????????/????????????;
????????????/????????????/?????_oowwww/??_{~~~~~~FB/_wFFFF^~~~~};
b~~~????????/F~~~????????/~~~N????????/@@??????????/????????????;
????????????/????????????/wwwwoo_?????/BF~~~~~~{_??/}~~~~^FFFFw_;
~~wwww?~~~~~/?B{{{{~~~~~~/???BFF~~~~~~/??????~~F@??/??????~~~{ww;
~~~~~?wwww~~/~~~~~~{{{{B?/~~~~~~FFB???/??@F~~??????/ww{~~~??????;
????????????/????????????/???????????w/??????????}~/?????????}~~;
????????????/?????????_oo/????????}~~^/????????~~~{/????????~~~w;
????????}~~~/???????{~~~~/??????w~~~~~/??????~~F@??/??????~~~{ww;
????????????/oo_?????????/^~~}????????/{~~~????????/w~~~????????;
????????~~~b/oooooooo~~~F/~~pp~~~~pp}~/@@@@@@@@@@@@/????????????;
????????????/?owEEEEE]w_?/?^~_?????~~?/??@FEEEEE@??/????????????;
????????????/????W}}?????/?????~~?????/???EEFFEE???/????????????;
????????????/?W]EEEEEE}w?/?_w[KEEEBB@?/?FFEEEEEEEE?/????????????;
????????????/??EEEEeu}]M?/?__?EFFFE}w?/?@FEEEEEEF@?/????????????;
????????????/???_ow[M}}??/?]^ZXWWW~~W?/????????FF??/????????????;
????????????/?}}EEEEEEE??/?bbBBBBBB~{?/?@FEEEEEEF@?/????????????;
????????????/?_w]EEEEEE??/?~~EEEEEE}w?/?@FEEEEEEF@?/????????????;
????????????/?]]EEEEEe}}?/?????{}FB@??/?????FF?????/????????????;
????????????/?w}EEEEEEw??/?xFFEEEMMxw?/?@EEEEEEEF@?/????????????;
????????????/?w}EEEEEE}w?/?@FEEEEEe~^?/??EEEEEEF@??/????????????;
????????????/oooooooooooo/~~pp~~~~ppn^/@@@@@@@@~~~{/????????~~~w;
????????????/oooooooooooo/^npp~~~~pp~~/{~~~@@@@@@@@/w~~~????????;
????????????/?????????_oo/????????M~~~/??????????@@/????????????;
????????????/oooooooooooo/~~pp~~~~pp~~/@@@@@@@@@@@@/????????????;
????????????/oo_?????????/~~~M????????/@@??????????/????????????;
????????????/????????????/w???????????/~}??????????/~~}?????????;
~~~}????????/~~~~{???????/~~~~~w??????/??@F~~??????/ww{~~~??????;
????????????/?ow[MEEM[wo?/?~~KKKKKK~~?/?FF??????FF?/????????????;
????????????/????????????/????????????/????????????/????????????;
????????????/?_w]EEEEE]W?/?^~_?????__?/??@FEEEEEF@?/????????????;
b~~~????????/F~~~oooooooo/^mpp~~~~pp~~/{~~~@@@@@@@@/w~~~????????;
????????????/??}}EEEEEEE?/??~~EEEEE???/??FFEEEEEEE?/????????????;
????????????/??}}EEEEEEE?/??~~EEEEE???/??FF????????/????????????;
????????~~~b/oooooooo~~~F/~~pp~~~~ppm^/@@@@@@@@~~~{/????????~~~w;
????????????/?}}??????}}?/?~~EEEEEE~~?/?FF??????FF?/????????????;
????????????/???EE}}EE???/?????~~?????/???EEFFEE???/????????????;
????????????/??????}}}}}}/???oww~~~~~~/?oNNNN~~~~~~/~~FFFF?~~~~~;
????????????/}}}}}}??????/~~~~~~wwo???/~~~~~~NNNNo?/~~~~~?FFFF~~;
????????????/??}}????????/??~~????????/??FFEEEEEEE?/????????????;
????????????/?}}w_??_w}}?/?~~@BFFB@~~?/?FF??????FF?/????????????;
~~wwww?~~~~~/?B{{{{~~~~~~/???BFF~~~~~~/??????NNNNNN/????????????;
????????????/?w}EEEEEE}w?/?~~??????~~?/?@FEEEEEEF@?/????????????;
????????????/?}}EEEEEE}w?/?~~KKKKKKNB?/?FF?????????/????????????;
~~~~~?wwww~~/~~~~~~{{{{B?/~~~~~~FFB???/NNNNNN??????/????????????;
????????????/?}}EEEEEE}w?/?~~KK[{{mFB?/?FF????@FFE?/????????????;
????????????/?w}EEEEE]W??/?`fEEEEEE}w?/?@FEEEEEEF@?/????????????;
????????????/?EEEE}}EEEE?/?????~~?????/?????FF?????/????????????;
~~~~~???????/~~~~@???????/~~~B????????/~~B?????????/~B??????????;
????????????/?}}??????}}?/?FN}woow}NF?/????@FF@????/????????????;
????????????/?}}??????}}?/?~~w{^^{w~~?/??FB????BF??/????????????;
???{KKK{KKK{/???~KKK~KKK~/???~KKK~KKK~/???~KKK~KKK~/???NKKKNKKKN;
????????????/?}}_????_}}?/??@BF}}FB@??/?????FF?????/????????????;
KKK{KKK{KKK{/KKK~KKK~KKK~/KKK~KKK~KKK~/KKK~KKK~KKK~/KKKNKKKNKKKN;
??????~~~NFF/??????~~w_??/??????F~~~~~/???????N~~~~/????????^~~~;
b~~~????????/F~~~oooooooo/~}pp~~~~pp~~/@@@@@@@@@@@@/????????????;
FFN~~~??????/??_w~~??????/~~~~~F??????/~~~~N???????/~~~^????????;
?????????^~~/??????????^~/???????????F/????????????/????????????;
~~^?????????/~^??????????/F???????????/????????????/????????????;
????????~~~b/????????~~~F/????????N~~~/??????????@@/????????????;
?oww{{A~~BBB/~~~~~~{xxwww/~~~~~~~~~~~~/^~~~~~FrrBBB/?@BBFFG^^WWW;
BA{{{wwo_???/w{~~~~~~~~{o/~~~~p__p~~~~/BF~~~~~~~^F@/WGFFFBB@????;
???_oww{{{AB/o{~~~~~~~~{w/~~~~p__p~~~~/@F^~~~~~~~FB/????@BBFFFGW;
BBB~~A{{wwo?/wwwxx{~~~~~~/~~~~~~~~~~~~/BBBrrF~~~~~^/WWW^^GFFBB@?;
??w}~~~~~~~~/w}xxxxF~~~~~/N~????o~~~~~/??N~~~~~~~FB/???@FN^^~~~};
~~~~~~~~}w??/~~~~~Fxxxx}w/~~~~~o????~N/BF~~~~~~~N??/}~~~^^NF@???;
???_w{}}~~~^/??{~~~~~~~wo/{~????B~~~~~/F^ffffw~~~~~/??F^~~~~~~~~;
^~~~}}{w_???/ow~~~~~~~{??/~~~~~B????~{/~~~~~wffff^F/~~~~~~~~^F??;
????????????/}}}]MMMM]}}}/~~p??????p~~/NNNNMMMMNNNN/????????????;
??????~~~NFF/??????~~w_??/??????~~~~~~/??????~~F@??/??????~~~{ww;
FFN~~~??????/??_w~~??????/~~~~~~??????/??@F~~??????/ww{~~~??????;
????????????/??????}}}}}}/??????~~~~~~/??????~~F@??/??????~~~{ww;
????????????/}}}]MMMM]}}}/~~p??????p~~/??@F}}MMNNNN/ww{~~~??????;
????????????/}}}]MMMM]}}}/~~p??????p~~/NNNNMM}}F@??/??????~~~{ww;
????????????/}}}}}}??????/~~~~~~??????/??@F~~??????/ww{~~~??????;
??????~~~NFF/}}}]MMNNW_??/~~p??????p~~/NNNNMMMMNNNN/????????????;
FFN~~~??????/??_w~~??????/~~~~~~??????/NNNNNN??????/????????????;
??????~~~NFF/??????~~w_??/??????~~~~~~/??????NNNNNN/????????????;
FFN~~~??????/??_WNNMM]}}}/~~p??????p~~/NNNNMMMMNNNN/????????????;
????????????/{{{{{wwwwwoo/~~~~~~~~~~~~/FFFFFBBBBB@@/????????????;
????????????/oo____??????/~~~~~~^^^MMM/@@??????????/????????????;
????????????/??????____oo/MMM^^^~~~~~~/??????????@@/????????????;
????????????/oowwwww{{{{{/~~~~~~~~~~~~/@@BBBBBFFFFF/????????????;
??????????o~/?????????o~~/????????o~~~/???????_~~~~/???????~~~~~;
~o??????????/~~o?????????/~~~o????????/~~~~_???????/~~~~~???????;
???????~~~~~/???????@~~~~/????????B~~~/?????????B~~/??????????B~;
????????????/????????_oWK/??????]rx{}~/????????@BFH/????????????;
????????~~~b/????????~~~F/????????~~~^/????????~~~{/????????~~~w;
????????????/cwo_????????/~^Nfr]??????/KEB@????????/????????????;
????????????/????????????/??____??????/??FF~~??????/????????????
)";

constexpr auto font_10x16 = R"(0;1;1;10;0;2;16;0{ @
X~~???????/e~~???????/HNN???????;
?????~~fBB/?_W[[~~~~~/NNBBB?NNNN;
BBf~~?????/~~~~~[[W_?/NNNN?BBBNN;
?@E]}~~~vb/?????@@BBB/??????????;
bv~~~}]E@?/BBB@@?????/??????????;
??????????/???_oww{{[/?GEFFNNNMK;
X~~???????/]NF???????/??????????;
??????????/[{{wwo_???/KMNNNFFEG?;
N^kkko~~~~/??@BB~~^NN/?????NNMKK;
~~~~okkk^N/NN^~~BB@??/KKMNN?????;
??????????/????????_{/???????GNN;
?????????_/???????}~f/???????NNH;
??????w~~~/?????{~^NN/?????NNMKK;
_?????????/f~}???????/HNN???????;
_______~~X/^XX^^^XX[]/??????????;
?_OOOOo_??/FNWOOOONF?/??????????;
???_oo????/??OO^^OO??/??????????;
_oOOOOOo_?/W[[UQQRRP?/??????????;
?OOOOOooO?/GWOOQRR]K?/??????????;
???_oOoo??/CEFDCC^^C?/??????????;
ooOOOOOO??/HXPPPPP^M?/??????????;
?_oOOOOO??/N^QQQQQ]K?/??????????;
ooOOOOOoo?/???[]A@@??/??????????;
_oOOOOO_??/LRRQQQU\K?/??????????;
_oOOOOOo_?/@RQQQQYNF?/??????????;
__________/^XX^^^Xxrf/???????NNH;
__________/bxx^^^XX^^/HNN???????;
?????????_/???????EN^/??????????;
__________/^XX^^^XX^^/??????????;
_?????????/^NE???????/??????????;
??????????/{_????????/NNG???????;
~~~w??????/NN^~{?????/KKMNN?????;
??_oOo_???/]^DCCCD^]?/??????????;
??????????/??????????/??????????;
?_oOOOOo_?/FNWOOOOWG?/??????????;
X~~_______/exx^^^XX^^/HNN???????;
?ooOOOOOO?/?^^QQQQOO?/??????????;
?ooOOOOOO?/?^^AAAA???/??????????;
_______~~X/^XX^^^Xx~e/???????NNH;
oo?????oo?/^^AAAAA^^?/??????????;
??OOooOO??/??OO^^OO??/??????????;
?????ooooo/?_W[[~~~~~/NNBBB?NNNN;
ooooo?????/~~~~~[[W_?/NNNN?BBBNN;
?oo???????/?^^OOOOOO?/??????????;
ooo_?_ooo?/^^@BFB@^^?/??????????;
N^kkko~~~~/??@BB~~~~~/??????????;
_oOOOOOo_?/N^OOOOO^N?/??????????;
ooOOOOOo_?/^^CCCCCFB?/??????????;
~~~~okkk^N/~~~~~BB@??/??????????;
ooOOOOOo_?/^^CCCK]ZP?/??????????;
_oOOOOo_??/HZQQQQQ]K?/??????????;
?OOOooOOO?/????^^????/??????????;
~~~N??????/~~B???????/N?????????;
oo?????oo?/BFM[W[MFB?/??????????;
oo?????oo?/F^KMFMK^F?/??????????;
????}aaaa}/????~GGGG~/????BAAAAB;
?oo????oo?/??@B]]B@??/??????????;
aaaa}aaaa}/GGGG~GGGG~/AAAABAAAAB;
?????~~fBB/?????B~~~~/???????NNN;
X~~_______/[XX^^^XX^^/??????????;
BBf~~?????/~~~~B?????/NNN???????;
????????N~/?????????B/??????????;
~N????????/B?????????/??????????;
???????~~X/???????FN]/??????????;
w{}}}pnn``/~~~~~~^^^^/@BFFFGNNGG;
`p}}}{{wo?/^~~|ww|~~N/GGFFFBB@??;
?ow{{}}}p`/N~~|ww|~~^/??@BBFFFGG;
``nnp}}}{w/^^^^~~~~~~/GGNNGFFFB@;
owuvvN~~~~/BFWww{~~^N/???@BFFNNM;
~~~~Nvvuwo/N^~~{wwWFB/MNNFFB@???;
??_w{}}~nF/{}pppB~~~~/?@EMMNNNNN;
Fn~}}{w_??/~~~~Bppp}{/NNNNNMME@?;
oooooooooo/~~xoooox~~/??????????;
?????~~fBB/?????~~^NN/?????NNMKK;
BBf~~?????/NN^~~?????/KKMNN?????;
?????ooooo/?????~~^NN/?????NNMKK;
oooooooooo/NNXoooox~~/KKMNN?????;
oooooooooo/~~xooooXNN/?????NNMKK;
ooooo?????/NN^~~?????/KKMNN?????;
ooooo~~fBB/~~xoooox~~/??????????;
BBf~~?????/~~~~~?????/??????????;
?????~~fBB/?????~~~~~/??????????;
BBf~~ooooo/~~xoooox~~/??????????;
_______???/^^^^^^^NNN/??????????;
??????????/NNNNEEEEEE/??????????;
??????????/EEEEEENNNN/??????????;
??________/NN^^^^^^^^/??????????;
????????w~/??????_}~~/??????NNNN;
~w????????/~~}_??????/NNNN??????;
??????N~~~/???????B~~/?????????N;
????????_o/?????EJL\m/??????????;
???????~~X/???????~~e/???????NNH;
O_????????/vZJLE?????/??????????;
??????????/??[{{?????/??????????
)";

constexpr auto crouton_sprites_8x10 = std::to_array({
    R"(????Oggs/???????@)",
    R"([ggO????/@???????)",
    R"(????Ow{C/??????@@)",
    R"(C{wO????/@@??????)",
    R"(????gg{w/??????@?)",
    R"(w{gg????/?@??????)",
    R"(????{{CS/????@@@@)",
    R"(SC{{????/@@@@????)",
    R"(????CCgW/?????@??)",
    R"(ogC?????/??@@????)",
    R"(????wkSk/?????@@@)",
    R"(kSkw????/@@@?????)",
    R"(????Owgk/???????@)",
    R"(kgwO????/@???????)",
    R"(????[cSc/?????BAA)",
    R"(Sc[_????/AAAB????)",
    R"(????CC{S/????@@@?)",
    R"(O{?{????/?@@@????)",
});

constexpr auto crouton_sprites_15x12 = std::to_array({
    R"(???????oOOWggks/???????@@@BBBDD)",
    R"(sswwWOOo???????/DEAAB@@@???????)",
    R"(???????__wwGGGk/?????????BBAAAE)",
    R"(kGGGww__???????/EAAABB?????????)",
    R"(???????OOwwKKGg/???????@@BBEEAA)",
    R"(gGKKwwOO???????/AAEEBB@@???????)",
    R"(???????{{CCCssS/???????FFCCCDDD)",
    R"(SssCCC{{???????/DDDCCCFF???????)",
    R"(???????CCCKggwO/???????CEEBB@@@)",
    R"(OoowWKKC???????/@BAAECCC???????)",
    R"(???????wwkkSSkk/???????BBEEDDEE)",
    R"(SSkk[[ww???????/DDEEFFBB???????)",
    R"(???????ooow??ss/???????@@@B??DD)",
    R"(ss??wooo???????/DD??B@@@???????)",
    R"(???????[[ccSScc/?????????BBAAAA)",
    R"(ggGGww?????????/CCDDCCFF???????)",
    R"(???????CCCC{{cc/???????EECCFF??)",
    R"(__{{??{{???????/??FFCCFF???????)",
});

constexpr auto crouton_sprites_10x20 = std::to_array({
    R"(?????????_/?????Wkuz|/???????@BD/??????????)",
    R"(_?????????/}^msW?????/EB@???????/??????????)",
    R"(?????????_/?????W~@||/??????BAAE/??????????)",
    R"(_?????????/||@~W?????/EAAB??????/??????????)",
    R"(???????_??/?????A~@tt/?????@BEAA/??????????)",
    R"(??_???????/tt@~A?????/AAEB@?????/??????????)",
    R"(?????_____/?????~?}AY/?????FCDDD/??????????)",
    R"(_____?????/YA}?~?????/DDDCF?????/??????????)",
    R"(?????__???/??????`x~e/?????EB??@/??????????)",
    R"(????_?????/e{[F@?????/@BAEC?????/??????????)",
    R"(???????___/?????}~jTj/?????@BEFE/??????????)",
    R"(___???????/TjT~}?????/FEFB@?????/??????????)",
    R"(?????????_/?????W{?||/????????AE/??????????)",
    R"(_?????????/||?{W?????/EA????????/??????????)",
    R"(?????_____/?????NoMqi/??????BAAA/??????????)",
    R"(??????????/TLpNo?????/DDDCF?????/??????????)",
    R"(?????_____/???????~OO/?????ECF??/??????????)",
    R"(?_??_?????/O~??~?????/?FCCF?????/??????????)",
});

constexpr auto crouton_sprites_12x30 = std::to_array({
    R"(????????????/????????_oWK/??????]rx{}~/????????@BFH/????????????)",
    R"(????????????/cwo_????????/~^Nfr]??????/KEB@????????/????????????)",
    R"(????????????/???????wwW[[/??????]~~?~~/???????FFEMM/????????????)",
    R"(????????????/[[Www???????/~~?~~]??????/MMEFF???????/????????????)",
    R"(????????????/??????_ww[[W/??????`~~?zz/??????@FFMME/????????????)",
    R"(????????????/W[[ww_??????/zz?~~`??????/EMMFF@??????/????????????)",
    R"(????????????/??????{{Kkkk/??????~~?~`l/??????NNKLLL/????????????)",
    R"(????????????/kkkK{{??????/l`~?~~??????/LLLKNN??????/????????????)",
    R"(????????????/??????CKWwoo/????????o~~p/??????KFB@@@/????????????)",
    R"(????????????/___owK??????/b~~B????????/BBFEKG??????/????????????)",
    R"(????????????/??????_ww[{[/??????~~~TiT/??????@FFNMN/????????????)",
    R"(????????????/{[{ww_??????/iTi~~~??????/MNMFF@??????/????????????)",
    R"(????????????/??????????W[/??????]~~?~~/??????????EM/????????????)",
    R"(????????????/[W??????????/~~?~~]??????/ME??????????/????????????)",
    R"(????????????/??????{CsSSS/??????FwFwFX/???????FCDDD/????????????)",
    R"(????????????/gggGw???????/ewFwFw??????/IIIJGN??????/????????????)",
    R"(????????????/??????KKK{KK/?????????~WW/??????NKKN??/????????????)",
    R"(????????????/?{???{??????/W~???~??????/?NKKKN??????/????????????)",
});

constexpr auto crouton_sprites_10x16 = std::to_array({
    R"(????????_o/?????EJL\m/??????????)",
    R"(O_????????/vZJLE?????/??????????)",
    R"(??????___o/?????E^OUu/??????????)",
    R"(o___??????/uUO^E?????/??????????)",
    R"(??????_o__/?????H^oUU/??????????)",
    R"(__o_??????/UUo^H?????/??????????)",
    R"(?????oOOOO/?????~_nhh/??????????)",
    R"(OOOOo?????/hhn_~?????/??????????)",
    R"(?????Oo__?/?????oWKFL/??????????)",
    R"(???_o?????/J]Rp_?????/??????????)",
    R"(??????_ooo/?????N^tyt/??????????)",
    R"(ooo_??????/yty^N?????/??????????)",
    R"(????????_o/?????EN?Uu/??????????)",
    R"(o_????????/uU?NE?????/??????????)",
    R"(?????oOOOO/?????B[RTT/??????????)",
    R"(____??????/iikb{?????/??????????)",
    R"(?????OOoOO/?????o_~CC/??????????)",
    R"(?o??o?????/C~__~?????/??????????)",
});

namespace {

    constexpr auto croutons = std::to_array({0, 0, 1, 2, 3, 4, 5, 0, 6, 7, 2, 1, 4, 5, 3, 2, 7, 8, 1, 4, 3, 5, 6, 2, 4, 0, 5, 2, 4, 7, 8, 5});

    auto guess_font_size(const int terminal_id)
    {
        switch (terminal_id) {
            case 1:  // VT220 - 8x10
            case 2:  // VT240 - 8x10
                return soft_font::size_8x10;
            case 24:  // VT320 - 15x12
            case 42:  // VT1000 - unknown, assumed VT320 compatible
                return soft_font::size_15x12;
            case 18:  // VT330 - 10x20
            case 19:  // VT340 - 10x20
                return soft_font::size_10x20;
            case 32:  // VT382J - 12x30
            case 44:  // VT382T - 12x30
                return soft_font::size_12x30;
            case 41:  // VT420 - 10x16
            case 61:  // VT510 - 10x16
            case 64:  // VT520 - 10x16
            case 65:  // VT525 - 10x16
            case 66:  // VTStar - 10x16
            default:  // Unknown - assume 10x16
                return soft_font::size_10x16;
        }
    }

    std::string get_font(const auto font_size)
    {
        switch (font_size) {
            case soft_font::size_8x10:
                return font_8x10;
            case soft_font::size_15x12:
                return font_15x12;
            case soft_font::size_10x20:
                return font_10x20;
            case soft_font::size_12x30:
                return font_12x30;
            case soft_font::size_10x16:
            default:
                return font_10x16;
        }
    }

    std::string_view get_font_header(const auto font_size)
    {
        switch (font_size) {
            case soft_font::size_8x10:
                return "1;4;0;0";
            case soft_font::size_15x12:
                return "1;15;0;2;12;0";
            case soft_font::size_10x20:
                return "1;10;0;2;20;0";
            case soft_font::size_12x30:
                return "1;12;0;2;30;0";
            case soft_font::size_10x16:
            default:
                return "1;10;0;2;16;0";
        }
    }

    const auto& get_crouton_sprites(const auto font_size)
    {
        switch (font_size) {
            case soft_font::size_8x10:
                return crouton_sprites_8x10;
            case soft_font::size_15x12:
                return crouton_sprites_15x12;
            case soft_font::size_10x20:
                return crouton_sprites_10x20;
            case soft_font::size_12x30:
                return crouton_sprites_12x30;
            case soft_font::size_10x16:
            default:
                return crouton_sprites_10x16;
        }
    }

}  // namespace

soft_font::soft_font(const capabilities& caps)
    : _font_size{guess_font_size(caps.terminal_id)}
{
    if (caps.has_soft_fonts) {
        auto font_data = get_font(_font_size);
        // Some terminals (like RLogin) will not cope with DECDLD content
        // containing newlines, so we need to strip those out first.
        for (auto i = 0; i < font_data.size(); i++)
            if (font_data[i] == '\n')
                font_data.erase(i--, 1);
        std::cout << "\033P" << font_data << "\033\\";
        // VTStar seems to get itself stuck when downloading a soft font, but
        // that can be fixed by flooding it with a bunch of SGR sequences.
        for (auto i = 0; i < 100; i++)
            std::cout << "\033[0;1m";
        std::cout << "\033[m";
        // We enable the new font by default.
        std::cout << "\033( @";
    }
}

soft_font::~soft_font()
{
    // Make sure the ASCII character set is restored on exit.
    std::cout << "\033(B";
}

void soft_font::init(const int wave)
{
    // Each wave potentially has a differently style of crouton, and we can't
    // fit them all in the same font, so we redefine the crouton sprites at the
    // start of every level.
    const auto index = croutons[(wave - 1) % croutons.size()];
    const auto font_header = get_font_header(_font_size);
    const auto& crouton_sprites = get_crouton_sprites(_font_size);
    std::cout << "\033P0;91;" << font_header << "{ @" << crouton_sprites[index * 2] << "\033\\";
    std::cout << "\033P0;93;" << font_header << "{ @" << crouton_sprites[index * 2 + 1] << "\033\\";
}
